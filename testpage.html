<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>TODO supply a title</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <script type="text/javascript" src="js/libs/jquery/jquery.js"></script>       
        
        <script type="text/javascript">
            function postJSON(dataObject,url)
            {       
                var sendString = '';
                //sendString = objToString(dataObject);
                
                sendString = $(this).serialize() + "&" + $.param(dataObject);
                
                $.ajax({
                    type: "POST",
                    url: url,
                    data: dataObject,                    
                    cache: false,                    
                    success: function(data, textStatus, jqXHR){processJSONCall(data,textStatus,dataObject);},            
                    error:function(jqXHR, textStatus, errorThrown){errorAlert(jqXHR,textStatus,errorThrown,dataObject);},
                });                 
            }
            
            function processJSONCall (data,textStatus,dataObject)
            {                             
                var dataReturned = 0;
                var action = dataObject.action;   
                
                //alert(data);
                var jsonobj = jQuery.parseJSON( data ); ;
                
                if(action === 'login')
                {                                  
                    if(jsonobj.status === 'Success')
                    {                        
                        $('#sessionid').val(jsonobj.session_id);
                    }else{
                        alert('Login failed:'+jsonobj.error);
                    }
                }
                else if(action === 'get_balance')
                {                    
                    if(jsonobj.status === 'Success')
                    {
                        alert('Pool: '+jsonobj.pool_balance+' KCM:'+jsonobj.kcm_wallet_balance+' GLO:'+jsonobj.glo_wallet_balance);
                    }else{
                        alert('Get balance failed:'+jsonobj.error);
                    }
                }
                else if(action === 'get_statement')
                {                    
                    if(jsonobj.status === 'Success')
                    {
                        alert('Statement: '+jsonobj.statement);
                    }else{
                        alert('Get statement failed:'+jsonobj.error);
                    }
                }
                
            }
            
            function errorAlert(jqXHR,textStatus,errorThrown,dataObject)
            {                          
                if(errorThrown !== '')
                {
                    alert('[AJAX ERROR]: '+errorThrown);
                }
            }
                        
            function objToString (obj) 
            {
                var tabjson=[];
                for (var p in obj) {
                    if (obj.hasOwnProperty(p)) {
                        tabjson.push('"'+p +'"'+ ':"' + obj[p]+'"');
                    }
                }  tabjson.push()
                return '{'+tabjson.join(',')+'}';
            }
            // /////////////////////////////////////////////////////////////////
            function getSession()
            {
                var dataObject = {"action":"login","login_str":"tha001testcompany","password":"thapelo1234"};                                                   
                postJSON(dataObject,'http://localhost/webservice/index.php');
            }
            
            function getBalance()
            {
                var dataObject = {"action":"get_balance","session_id":$('#sessionid').val(),"uid":$('#userid').val()};                     
                postJSON(dataObject,'http://localhost/webservice/index.php');
            }
            
            function getStatement()
            {
                var dataObject = {"action":"get_statement","session_id":$('#sessionid').val(),"uid":$('#userid').val()};                     
                postJSON(dataObject,'http://localhost/webservice/index.php');
            }
            
        </script>
    </head>
    <body>
        <input type="hidden" name="sessionid" id="sessionid"/>
        <input type="hidden" name="userid" id="userid" value="123"/>
        
        <input type="button" value="Test session" onclick="getSession()"/>
        
        <input type="button" value="Test one" onclick="getBalance()"/>
        
        <input type="button" value="Test two" onclick="getStatement()"/>
        <br>
    </body>
</html>
