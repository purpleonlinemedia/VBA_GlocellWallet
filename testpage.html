<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>TODO supply a title</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <script type="text/javascript" src="js/libs/jquery/jquery.js"></script>       
        
        <script type="text/javascript">
            function postXML(xmlString,url,action)
            {       
                //var sendString = '';
                //sendString = objToString(dataObject);
                
                //sendString = $(this).serialize() + "&" + $.param(dataObject);
                
                $.ajax({
                    type: "POST",
                    url: url,
                    data: xmlString,   
                    contentType: "text/xml",
                    cache: false,    
                    dataType: "text",
                    //success: function(data, textStatus, jqXHR){processResponse(data,textStatus,action);},            
                    success: function(data, textStatus, jqXHR){responseMessage(data,textStatus,action);},            
                    error:function(jqXHR, textStatus, errorThrown){errorAlert(jqXHR,textStatus,errorThrown,action);},
                });                 
            }
           
            function processResponse (data,textStatus,action)
            {                             
                var dataReturned = 0;
               
                //alert(data);
                var xmlobj = jQuery.parseXML( data ); ;
                
                if(action === 'login')
                {                                  
                    if(xmlobj.status === 'Success')
                    {                        
                        $('#sessionid').val(xmlobj.session_id);
                    }else{
                        alert('Login failed:'+xmlobj.error);
                    }
                }
                else if(action === 'get_balance')
                {                    
                    if(xmlobj.status === 'Success')
                    {
                        alert('Pool: '+xmlobj.pool_balance+' KCM:'+xmlobj.kcm_wallet_balance+' GLO:'+xmlobj.glo_wallet_balance);
                    }else{
                        alert('Get balance failed:'+xmlobj.error);
                    }
                }
                else if(action === 'get_statement')
                {                    
                    if(xmlobj.status === 'Success')
                    {
                        alert('Statement: '+xmlobj.statement);
                    }else{
                        alert('Get statement failed:'+xmlobj.error);
                    }
                }
                else if(action === 'funds_transfer')
                {                    
                    if(xmlobj.status === 'Success')
                    {
                        alert('Success');
                    }else{
                        alert('Trasnfer failed:'+jsonobj.error);
                    }
                }
                
            }
            
            function errorAlert(jqXHR,textStatus,errorThrown,dataObject)
            {                          
                if(errorThrown !== '')
                {
                    alert('[AJAX ERROR]: '+errorThrown);
                }
            }
                        
            function objToString (obj) 
            {
                var tabjson=[];
                for (var p in obj) {
                    if (obj.hasOwnProperty(p)) {
                        tabjson.push('"'+p +'"'+ ':"' + obj[p]+'"');
                    }
                }  tabjson.push()
                return '{'+tabjson.join(',')+'}';
            }
            // /////////////////////////////////////////////////////////////////
            function getSession()
            {
                var dataObject = {"action":"login","login_str":"tha001testcompany","password":"thapelo1234"}; 
                var xmlString ="<?xml version='1.0'?><serviceRequest><action>login</action><login_str>tha001testcompany</login_str><password>thapelo1234</password></serviceRequest>";
                postXML(xmlString,'http://localhost/webservice/index.php','login');
            }
            
            function getBalance()
            {
                var dataObject = {"action":"get_balance","session_id":$('#sessionid').val(),"uid":$('#userid').val()};                     
                postXML(dataObject,'http://localhost/webservice/index.php');
            }
            
            function getStatement()
            {
                var dataObject = {"action":"get_statement","session_id":$('#sessionid').val(),"uid":$('#userid').val()};                     
                postXML(dataObject,'http://localhost/webservice/index.php');
            }
            
            function fundsTransfer()
            {
                var dataObject = {"action":"funds_transfer","session_id":$('#sessionid').val(),"value":$('#transferAmount').val(),"sourceacc":$('#sourceacc').val(),"destacc":$('#destacc').val(),"uid":$('#userid').val()};                     
                postXML(dataObject,'http://localhost/webservice/index.php');
            }
        </script>
    </head>
    <body>
        <input type="hidden" name="sessionid" id="sessionid"/>
        <input type="hidden" name="userid" id="userid" value="123"/>
        
        <input type="button" value="Test session" onclick="getSession()"/>
        
        <input type="button" value="Test one" onclick="getBalance()"/>
        
        <input type="button" value="Test two" onclick="getStatement()"/>
        <br>
        <br>
        <input type="text" id="transferAmount" name="transferAmount"/>
        <br>
        From:
        <select id="sourceacc">
            <option value="pool">pool</option>
            <option value="glocell">glocell</option>
            <option value="kcmobile">kcmobile</option>
        </select>
        To:
        <select id="destacc">
            <option value="pool">pool</option>
            <option value="glocell">glocell</option>
            <option value="kcmobile">kcmobile</option>
        </select>
        <br>
        <input type="button" value="Transfer" onclick="fundsTransfer()"/>
    </body>
</html>
